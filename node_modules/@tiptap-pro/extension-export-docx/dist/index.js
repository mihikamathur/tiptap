import{Packer as S}from"docx";import{Document as lt,LevelFormat as I,Paragraph as ct,Table as mt}from"docx";import{AlignmentType as B}from"docx";function x(e){return e*240}function T(e){return e*2}function g(e){return e*20}var ie={paragraphStyles:[{id:"Normal",name:"Normal",run:{font:"Aptos",size:T(11)},paragraph:{spacing:{before:0,after:g(10),line:x(1.15)}}},{id:"ListParagraph",name:"List Paragraph",basedOn:"Normal",quickFormat:!0,run:{font:"Aptos",size:T(11)},paragraph:{spacing:{before:0,after:g(2),line:x(1)}}},{id:"Heading1",name:"Heading 1",basedOn:"Normal",next:"Normal",quickFormat:!0,run:{font:"Aptos Light",size:T(16),bold:!0,color:"2E74B5"},paragraph:{spacing:{before:g(12),after:g(6),line:x(1.15)}}},{id:"Heading2",name:"Heading 2",basedOn:"Normal",next:"Normal",quickFormat:!0,run:{font:"Aptos Light",size:T(14),bold:!0,color:"2E74B5"},paragraph:{spacing:{before:g(12),after:g(6),line:x(1.15)}}},{id:"Heading3",name:"Heading 3",basedOn:"Normal",next:"Normal",quickFormat:!0,run:{font:"Aptos",size:T(13),bold:!0,color:"2E74B5"},paragraph:{spacing:{before:g(12),after:g(6),line:x(1.15)}}},{id:"Heading4",name:"Heading 4",basedOn:"Normal",next:"Normal",quickFormat:!0,run:{font:"Aptos",size:T(12),bold:!0,color:"2E74B5"},paragraph:{spacing:{before:g(12),after:g(6),line:x(1.15)}}},{id:"Heading5",name:"Heading 5",basedOn:"Normal",next:"Normal",quickFormat:!0,run:{font:"Aptos",size:T(11),bold:!0,color:"2E74B5"},paragraph:{spacing:{before:g(12),after:g(6),line:x(1.15)}}},{id:"Title",name:"Title",basedOn:"Normal",next:"Normal",quickFormat:!0,run:{font:"Aptos Light",size:T(22),bold:!0,color:"000000"},paragraph:{alignment:B.CENTER,spacing:{before:0,after:0,line:x(1.15)}}},{id:"Subtitle",name:"Subtitle",basedOn:"Normal",next:"Normal",quickFormat:!0,run:{font:"Aptos Light",size:T(16),italics:!0,color:"666666"},paragraph:{alignment:B.CENTER,spacing:{before:0,after:0,line:x(1.15)}}},{id:"Quote",name:"Quote",basedOn:"Normal",quickFormat:!0,run:{font:"Aptos",italics:!0},paragraph:{alignment:B.CENTER,spacing:{before:g(10),after:g(10),line:x(1.15)}}},{id:"IntenseQuote",name:"Intense Quote",basedOn:"Normal",quickFormat:!0,run:{font:"Aptos",italics:!0,color:"444444"},paragraph:{alignment:B.CENTER,spacing:{before:g(10),after:g(10),line:x(1.15)}}},{id:"NoSpacing",name:"No Spacing",basedOn:"Normal",quickFormat:!0,paragraph:{spacing:{before:0,after:0,line:x(1)}}},{id:"Hyperlink",name:"Hyperlink",basedOn:"Normal",run:{color:"0563C1",underline:{type:"single"}}}]},se={width:800,height:400};import{AlignmentType as z,HeadingLevel as M,Paragraph as G,TextRun as _}from"docx";import{ImageRun as Ae,Paragraph as Re}from"docx";async function le(e){let n=new TextDecoder("utf-8").decode(e.subarray(0,100)),r="image/png";return n.includes("<svg")?r="image/svg+xml":n.startsWith("\x89PNG")?r="image/png":n.startsWith("\xFF\xD8")&&(r="image/jpeg"),new Promise((a,t)=>{let o=new Blob([e],{type:r}),i=URL.createObjectURL(o),s=new Image;s.onload=()=>{URL.revokeObjectURL(i),a({width:s.naturalWidth,height:s.naturalHeight})},s.onerror=l=>{URL.revokeObjectURL(i),t(l)},s.src=i})}async function ce(e){try{let{imageSize:n}=await import("image-size"),r=n(e);if(r.width&&r.height)return{width:r.width,height:r.height}}catch(n){console.warn("Error getting server-side image dimensions:",n)}return se}var me=["png","jpg","jpeg","gif","bmp","svg"];function Le(e,n){let r=n.get("content-type");if(r){if(r.includes("png"))return"png";if(r.includes("jpeg")||r.includes("jpg"))return"jpg";if(r.includes("gif"))return"gif";if(r.includes("bmp"))return"bmp";if(r.includes("svg"))return"svg"}if(r==="binary/octet-stream"){let a=new URL(e),t=a.pathname.substring(a.pathname.lastIndexOf("/")+1),o=t.substring(t.lastIndexOf(".")+1).toLowerCase();if(me.includes(o))return o}throw new Error(`Unsupported image type [${r}]. Only ${me.join(", ")} are supported.`)}function pe(e){return e*.75}async function De(e){try{return typeof window!="undefined"?await le(e):await ce(e)}catch(n){return console.warn("Could not determine image dimensions, using defaults:",n),{width:800,height:400}}}async function R({node:e}){var u;let n=(u=e.attrs)==null?void 0:u.src;if(!n)throw new Error("Image node missing src attribute.");let r=await fetch(n);if(!r.ok)throw new Error(`Failed to fetch image from ${n}: ${r.statusText}`);let a=await r.arrayBuffer(),t=typeof Buffer!="undefined"&&typeof Buffer.from=="function"?Buffer.from(a):new Uint8Array(a),o=Le(n,r.headers),i={width:800,height:400};try{i=await De(t)}catch(p){console.warn("Could not determine intrinsic dimensions, using defaults.",p)}let s=pe(i.width),l=pe(i.height),c;o==="svg"?c={data:t,transformation:{width:s,height:l},type:o,fallback:{type:"jpg",data:""}}:c={data:t,transformation:{width:s,height:l},type:o};let m=new Ae(c);return new Re({children:[m]})}import{Math as ye,MathRun as We}from"docx";import{MathFraction as xe,MathRadical as be,MathRun as v,MathSubScript as qe,MathSubSuperScript as Ue,MathSuperScript as ze}from"docx";import{BuilderElement as Be}from"docx";import{BuilderElement as E}from"docx";var ue=e=>{let{columnCount:n,columnAlignment:r="center"}=e,a=new E({name:"m:mcPr",children:[new E({name:"m:count",attributes:{val:{key:"m:val",value:n.toString()}}}),new E({name:"m:mcJc",attributes:{val:{key:"m:val",value:r}}})]}),t=new E({name:"m:mc",children:[a]}),o=new E({name:"m:mcs",children:[t]}),i=new E({name:"w:rPr",children:[new E({name:"w:rFonts",attributes:{ascii:{key:"w:ascii",value:"Cambria Math"},hAnsi:{key:"w:hAnsi",value:"Cambria Math"}}}),new E({name:"w:i"})]}),s=new E({name:"m:ctrlPr",children:[i]});return new E({name:"m:mPr",children:[o,s]})};import{BuilderElement as Se}from"docx";import{BuilderElement as ke}from"docx";var fe=e=>new ke({name:"m:e",children:e});var de=e=>{let n=e.cells.map(r=>fe(r));return new Se({name:"m:mr",children:n})};var he=e=>{let{rows:n,columnCount:r,columnAlignment:a}=e,t=ue({columnCount:r,columnAlignment:a}),o=n.map(i=>de(i));return new Be({name:"m:m",children:[t,...o]})};var ge={"\\sin":"sin","\\cos":"cos","\\tan":"tan","\\sec":"sec","\\csc":"csc","\\cot":"cot","\\sinh":"sinh","\\cosh":"cosh","\\tanh":"tanh","\\sech":"sech","\\csch":"csch","\\coth":"coth","\\arcsin":"arcsin","\\arccos":"arccos","\\arctan":"arctan","\\arcsec":"arcsec","\\arccsc":"arccsc","\\arccot":"arccot","\\log":"log","\\ln":"ln","\\sum":"\u2211","\\int":"\u222B","\\oint":"\u222E","\\iint":"\u222C","\\iiint":"\u222D","\\prod":"\u220F","\\coprod":"\u2210","\\lim":"lim","\\limsup":"lim sup","\\liminf":"lim inf","\\max":"max","\\min":"min","\\sup":"sup","\\inf":"inf","\\arg":"arg","\\ker":"ker","\\dim":"dim","\\hom":"hom","\\det":"det","\\exp":"exp","\\deg":"deg","\\gcd":"gcd","\\lcm":"lcm","\\alpha":"\u03B1","\\beta":"\u03B2","\\gamma":"\u03B3","\\delta":"\u03B4","\\epsilon":"\u03B5","\\varepsilon":"\u03B5","\\zeta":"\u03B6","\\eta":"\u03B7","\\theta":"\u03B8","\\vartheta":"\u03D1","\\iota":"\u03B9","\\kappa":"\u03BA","\\lambda":"\u03BB","\\mu":"\u03BC","\\nu":"\u03BD","\\xi":"\u03BE","\\omicron":"\u03BF","\\pi":"\u03C0","\\varpi":"\u03D6","\\rho":"\u03C1","\\varrho":"\u03F1","\\sigma":"\u03C3","\\varsigma":"\u03C2","\\tau":"\u03C4","\\upsilon":"\u03C5","\\phi":"\u03C6","\\varphi":"\u03C6","\\chi":"\u03C7","\\psi":"\u03C8","\\omega":"\u03C9","\\Alpha":"\u0391","\\Beta":"\u0392","\\Gamma":"\u0393","\\Delta":"\u0394","\\Epsilon":"\u0395","\\Zeta":"\u0396","\\Eta":"\u0397","\\Theta":"\u0398","\\Iota":"\u0399","\\Kappa":"\u039A","\\Lambda":"\u039B","\\Mu":"\u039C","\\Nu":"\u039D","\\Xi":"\u039E","\\Omicron":"\u039F","\\Pi":"\u03A0","\\Rho":"\u03A1","\\Sigma":"\u03A3","\\Tau":"\u03A4","\\Upsilon":"\u03A5","\\Phi":"\u03A6","\\Chi":"\u03A7","\\Psi":"\u03A8","\\Omega":"\u03A9","\\infty":"\u221E","\\pm":"\xB1","\\mp":"\u2213","\\cdot":"\u22C5","\\times":"\xD7","\\div":"\xF7","\\setminus":"\u2216","\\backslash":"\u2216","\\partial":"\u2202","\\nabla":"\u2207","\\triangle":"\u25B3","\\square":"\u25A1","\\blacksquare":"\u25A0","\\diamond":"\u25CA","\\blackdiamond":"\u25C6","\\emptyset":"\u2205","\\varnothing":"\u2205","\\leq":"\u2264","\\le":"\u2264","\\geq":"\u2265","\\ge":"\u2265","\\neq":"\u2260","\\ne":"\u2260","\\ll":"\u226A","\\gg":"\u226B","\\lll":"\u22D8","\\ggg":"\u22D9","\\approx":"\u2248","\\simeq":"\u2243","\\cong":"\u2245","\\equiv":"\u2261","\\sim":"\u223C","\\propto":"\u221D","\\prec":"\u227A","\\succ":"\u227B","\\preceq":"\u2AAF","\\succeq":"\u2AB0","\\parallel":"\u2225","\\perp":"\u22A5","\\mid":"\u2223","\\nmid":"\u2224","\\sub":"\u2282","\\cup":"\u222A","\\cap":"\u2229","\\subset":"\u2282","\\supset":"\u2283","\\subseteq":"\u2286","\\supseteq":"\u2287","\\subsetneq":"\u228A","\\supsetneq":"\u228B","\\in":"\u2208","\\notin":"\u2209","\\ni":"\u220B","\\owns":"\u220B","\\notni":"\u220C","\\sqsubset":"\u228F","\\sqsupset":"\u2290","\\sqsubseteq":"\u2291","\\sqsupseteq":"\u2292","\\bigcup":"\u22C3","\\bigcap":"\u22C2","\\bigsqcup":"\u2294","\\exists":"\u2203","\\forall":"\u2200","\\neg":"\xAC","\\land":"\u2227","\\lor":"\u2228","\\lnot":"\xAC","\\top":"\u22A4","\\bot":"\u22A5","\\vdash":"\u22A2","\\models":"\u22A8","\\leftarrow":"\u2190","\\gets":"\u2190","\\rightarrow":"\u2192","\\to":"\u2192","\\leftrightarrow":"\u2194","\\uparrow":"\u2191","\\downarrow":"\u2193","\\updownarrow":"\u2195","\\Leftarrow":"\u21D0","\\Rightarrow":"\u21D2","\\implies":"\u21D2","\\Leftrightarrow":"\u21D4","\\iff":"\u21D4","\\Uparrow":"\u21D1","\\Downarrow":"\u21D3","\\Updownarrow":"\u21D5","\\mapsto":"\u21A6","\\longmapsto":"\u27FC","\\hookleftarrow":"\u21A9","\\hookrightarrow":"\u21AA","\\leftharpoonup":"\u21BC","\\rightharpoonup":"\u21C0","\\leftharpoondown":"\u21BD","\\rightharpoondown":"\u21C1","\\rightleftharpoons":"\u21CC","\\overleftarrow":"\u2190","\\overrightarrow":"\u2192","\\overleftrightarrow":"\u2194","\\from":"\u2190","\\ast":"\u2217","\\star":"\u22C6","\\circ":"\u2218","\\bullet":"\u2022","\\dot":"\u02D9","\\ddot":"\xA8","\\tilde":"~","\\bar":"\xAF","\\hat":"^","\\check":"\u02C7","\\acute":"\xB4","\\grave":"`","\\overline":"\xAF","\\underline":"\xAF","\\overbrace":"\u23DE","\\underbrace":"\u23DF","\\sqrt":"\u221A","\\mathbb{N}":"\u2115","\\mathbb{Z}":"\u2124","\\mathbb{Q}":"\u211A","\\mathbb{R}":"\u211D","\\mathbb{C}":"\u2102","\\mathbb{H}":"\u210D","\\mathbb{P}":"\u2119","\\mathbb{E}":"E","\\lfloor":"\u230A","\\rfloor":"\u230B","\\lceil":"\u2308","\\rceil":"\u2309","\\langle":"\u27E8","\\rangle":"\u27E9","\\lbrace":"{","\\rbrace":"}","\\lvert":"|","\\rvert":"|","\\lVert":"\u2016","\\rVert":"\u2016","\\angle":"\u2220","\\measuredangle":"\u2221","\\sphericalangle":"\u2222","\\therefore":"\u2234","\\because":"\u2235","\\QED":"\u220E","\\boxtimes":"\u22A0","\\boxplus":"\u229E","\\boxminus":"\u229F","\\boxdot":"\u22A1","\\bmod":"mod","\\pmod":"mod","\\mod":"mod","\\Re":"\u211C","\\Im":"\u2111","\\wp":"\u2118","\\ell":"\u2113","\\hbar":"\u210F","\\mho":"\u2127","\\Finv":"\u2132","\\Game":"\u2141","\\Bbbk":"\u{1D55C}","\\vec":"\u20D7","\\mathring":"\u02DA"};function b(e){let n=[],r=e.trim().replace(/\\\\/g,"\\");for(;r.length>0;){let a=!1,t=r.match(/^\\sqrt\[([^\]]*)\]\{([^}]*)\}/);if(t){let o=t[1],i=t[2],s=b(o),l=b(i);n.push(new be({children:l,degree:s})),r=r.slice(t[0].length),a=!0}if(!a&&(t=r.match(/^\\sqrt\{([^}]*)\}/),t)){let o=t[1],i=b(o);n.push(new be({children:i})),r=r.slice(t[0].length),a=!0}if(!a&&(t=r.match(/^\\frac\{([^}]*)\}\{([^}]*)\}/),t)){let o=b(t[1]),i=b(t[2]);n.push(new xe({numerator:o,denominator:i})),r=r.slice(t[0].length),a=!0}if(!a&&(t=r.match(/^\\binom\{([^}]*)\}\{([^}]*)\}/),t)){let o=b(t[1]),i=b(t[2]);n.push(new v("(")),n.push(new xe({numerator:o,denominator:i})),n.push(new v(")")),r=r.slice(t[0].length),a=!0}if(!a){for(let[o,i]of Object.entries(ge))if(r.startsWith(o)){n.push(new v(i)),r=r.slice(o.length),a=!0;break}}if(!a&&(t=r.match(/^_(\{[^}]*\}|.)\^(\{[^}]*\}|.)/)||r.match(/^\^(\{[^}]*\}|.)_(\{[^}]*\}|.)/),t)){n.length===0&&n.push(new v(""));let o=n.pop(),i,s;r.startsWith("_")?(i=t[1].startsWith("{")?t[1].slice(1,-1):t[1],s=t[2].startsWith("{")?t[2].slice(1,-1):t[2]):(s=t[1].startsWith("{")?t[1].slice(1,-1):t[1],i=t[2].startsWith("{")?t[2].slice(1,-1):t[2]);let l=b(i),c=b(s);n.push(new Ue({children:[o],subScript:l,superScript:c})),r=r.slice(t[0].length),a=!0}if(!a&&(t=r.match(/^\^(\{[^}]*\}|.)/),t)){n.length===0&&n.push(new v(""));let o=n.pop(),i=t[1].startsWith("{")?t[1].slice(1,-1):t[1],s=b(i);n.push(new ze({children:[o],superScript:s})),r=r.slice(t[0].length),a=!0}if(!a&&(t=r.match(/^_(\{[^}]*\}|.)/),t)){n.length===0&&n.push(new v(""));let o=n.pop(),i=t[1].startsWith("{")?t[1].slice(1,-1):t[1],s=b(i);n.push(new qe({children:[o],subScript:s})),r=r.slice(t[0].length),a=!0}if(a||(t=r.match(/^\\(left|right)(.?)/),t&&(t[2]&&t[2]!=="\\"&&t[2]!=="."&&n.push(new v(t[2])),r=r.slice(t[0].length),a=!0)),!a&&(t=r.match(/^\\begin\{matrix\}([\s\S]*?)\\end\{matrix\}/),t)){let s=t[1].split(/\\\\|\\(?=[0-9&])/).filter(m=>m.trim()).map(m=>({cells:m.split("&").map(p=>p.trim()).map(p=>p?b(p):[new v("")])})),l=s.length>0?s[0].cells.length:1,c=he({rows:s,columnCount:l,columnAlignment:"center"});n.push(c),r=r.slice(t[0].length),a=!0}a||(t=r.match(/^\\begin\{[^}]*\}/),t&&(r=r.slice(t[0].length),a=!0)),a||(t=r.match(/^\\end\{[^}]*\}/),t&&(r=r.slice(t[0].length),a=!0)),a||(t=r.match(/^\\text\{([^}]*)\}/),t&&(n.push(new v(t[1])),r=r.slice(t[0].length),a=!0)),!a&&(r.startsWith("&")||r.startsWith("\\\\"))&&(r.startsWith("&")?(n.push(new v(" ")),r=r.slice(1)):(n.push(new v(" ")),r=r.slice(2)),a=!0),a||(t=r.match(/^\\([a-zA-Z]+)/),t&&(n.push(new v(t[1])),r=r.slice(t[0].length),a=!0)),a||(t=r.match(/^[^\\^_]+/),t&&(n.push(new v(t[0])),r=r.slice(t[0].length),a=!0)),a||(n.push(new v(r.charAt(0))),r=r.slice(1),a=!0)}return n.length>0?n:[new v(e)]}function q(e){var r;if(!((r=e.attrs)!=null&&r.latex))return null;let n=e.attrs.latex;try{let a=b(n);return new ye({children:a})}catch{return new ye({children:[new We(n)]})}}import{ExternalHyperlink as je,HighlightColor as Xe,ShadingType as Ge,TextRun as _e,UnderlineType as Qe}from"docx";function X(e){return e*.75*2}function we(e){let n=e.match(/\d+/g);if(!n||n.length<3)throw new Error("Invalid RGB input");return n.slice(0,3).map(r=>parseInt(r,10).toString(16).padStart(2,"0")).join("").toUpperCase()}var ve={black:"000000",blue:"0000FF",brown:"A52A2A",cyan:"00FFFF",gray:"808080",green:"00FF00",indigo:"4B0082",lime:"00FF00",magenta:"FF00FF",maroon:"800000",navy:"000080",olive:"808000",orange:"FFA500",pink:"FFC0CB",purple:"800080",red:"FF0000",teal:"008080",violet:"9400D3",white:"FFFFFF",yellow:"FFFF00"};function $e(e){let r=e.replace(/"/g,"").split(",").find(a=>a.trim().length>0);return r?r.trim():e}function Ve(e){return Object.values(Xe).includes(e)}function U(e){let n={},r=!1,a={};e.marks&&e.marks.forEach(o=>{var i,s;switch(o.type){case"bold":n.bold=!0;break;case"italic":n.italics=!0;break;case"underline":n.underline={type:Qe.SINGLE};break;case"strike":n.strike=!0;break;case"code":n.font="Courier New",n.shading={type:"solid",fill:"5805ff"},n.style="Code";break;case"textStyle":if(o.attrs){if(o.attrs.color&&o.attrs.color!=="")if(o.attrs.color.startsWith("#"))n.color=o.attrs.color;else if(Number.isInteger(Number(o.attrs.color))&&o.attrs.color.length===6)n.color=`#${o.attrs.color}`;else if(Number.isInteger(Number(o.attrs.color))&&o.attrs.color.length===3)n.color=`#${o.attrs.color.repeat(2)}`;else if(o.attrs.color.startsWith("rgb"))n.color=we(o.attrs.color);else{let l=ve[o.attrs.color];l?n.color=l:console.warn(`[convertTextNode] Invalid color: ${o.attrs.color}.
                    We couldn't process your color string to any of the available colors: ${new Intl.ListFormat("en",{style:"long",type:"conjunction"}).format(Object.keys(ve))}.
                    Supported formats are #000000 (6-digit hex), rgb(0, 0, 0), and the available color names.
                    This color will be ignored.`)}if(o.attrs.fontFamily&&(n.font=$e(o.attrs.fontFamily)),o.attrs.fontSize){let l=parseInt(o.attrs.fontSize,10);Number.isNaN(l)?console.warn(`[convertTextNode] Invalid fontSize: ${o.attrs.fontSize}. Expected a valid number. This value will be ignored.`):n.size=X(l)}}break;case"highlight":if(!((i=o.attrs)!=null&&i.color)){n.highlight="yellow";break}if(o.attrs.color.startsWith("#")){let l=o.attrs.color.slice(1).toUpperCase();n.shading={type:Ge.SOLID,fill:l};break}if(Ve(o.attrs.color)){n.highlight=o.attrs.color;break}n.highlight="yellow";break;case"link":r=!0,n.style="Hyperlink",a.href=(s=o.attrs)==null?void 0:s.href;break;default:break}});let t=new _e({text:e.text||"",...n});return r&&a?new je({link:a.href,children:[t]}):t}async function y({node:e,customNodes:n,options:r,list:a}){var m,u,p,f,N;if(r!=null&&r.style){let P=(e.content||[]).map(d=>d.type==="inlineMath"?q(d):d.type==="hardBreak"?new _({text:"",break:1}):U(d)).filter(d=>d!==null);return new G({children:P,style:r.style})}let t=z.LEFT;if(e.attrs&&e.attrs.textAlign)switch(e.attrs.textAlign){case"center":t=z.CENTER;break;case"right":t=z.RIGHT;break;default:t=z.LEFT}let o=1,i=(u=(m=e.marks)==null?void 0:m.filter(P=>P.type==="textStyle"))!=null?u:[];i.length>0&&((p=i[0].attrs)!=null&&p.lineHeight)&&(o=i[0].attrs.lineHeight);let s={paragraphs:[],currentTextRuns:[]},l=await(e.content||[]).reduce(async(P,d)=>{let h=await P,w=n.find(C=>C.type===d.type);if(w){let C=w.render(d);if(C===null)return h;if(C instanceof _)return h.currentTextRuns.push(C),h}if(d.type==="inlineMath"){let C=q(d);return C&&h.currentTextRuns.push(C),h}if(d.type==="hardBreak")return h.currentTextRuns.push(new _({text:"",break:1})),h;if(d.type==="image"){h.currentTextRuns.length>0&&(h.paragraphs.push(new G({children:[...h.currentTextRuns],alignment:t})),h.currentTextRuns=[]);let C=await R({node:d});return h.paragraphs.push(C),h}let H=U(d);return H&&h.currentTextRuns.push(H),h},Promise.resolve(s));if(l.currentTextRuns.length===0&&l.paragraphs.length===0)return[];if(l.currentTextRuns.length===0)return l.paragraphs.length===1?l.paragraphs[0]:l.paragraphs;let c;if(e.attrs&&e.attrs.level)switch(e.attrs.level){case 1:c=M.HEADING_1;break;case 2:c=M.HEADING_2;break;case 3:c=M.HEADING_3;break;case 4:c=M.HEADING_4;break;case 5:c=M.HEADING_5;break;case 6:c=M.HEADING_6;break;default:c=void 0}return l.paragraphs.push(new G({children:l.currentTextRuns,alignment:t,spacing:{line:x(o)},...(a==null?void 0:a.type)==="bullet"&&{bullet:{level:(f=a.level)!=null?f:0}},...(a==null?void 0:a.type)==="ordered"&&{numbering:{reference:"ordered-list",level:(N=a.level)!=null?N:0,instance:a.orderedListInstanceId}},...c&&{heading:c}})),l.paragraphs.length===1?l.paragraphs[0]:l.paragraphs}async function Q({node:e,customNodes:n}){return y({node:e,customNodes:n})}import{Paragraph as Ke,Run as Ye}from"docx";import{BuilderElement as Je}from"docx";var Ce=()=>new Je({name:"v:rect",attributes:{style:{key:"style",value:"width:0.0pt;height:.05pt;mso-width-percent:0;mso-height-percent:0;mso-width-percent:0;mso-height-percent:0"},hr:{key:"o:hr",value:"t"},hrstd:{key:"o:hrstd",value:"t"},hralign:{key:"o:hralign",value:"center"},fillcolor:{key:"fillcolor",value:"#A0A0A0"},stroked:{key:"stroked",value:"f"}}});import{BuilderElement as Ze}from"docx";var Te=e=>new Ze({name:"w:pict",children:e});var $=()=>new Ke({children:[new Ye({children:[Te([Ce()])]})],style:"horizontalRule"});var V=new Set;function Ne(){let e;do e=Math.floor(Math.random()*1e6)+1;while(V.has(e));return V.add(e),e}function Pe(){V.clear()}async function L({node:e,customNodes:n,level:r=0}){let a=Ne(),t=e.content||[];return(await Promise.all(t.map(i=>F({item:i,listType:"ordered",level:r,orderedListInstanceId:a,customNodes:n})))).flat().filter(i=>i!==null)}async function F({item:e,listType:n,level:r=0,orderedListInstanceId:a,customNodes:t}){if(!e.content)return[];let o=[],i=e.content;for(let s=0,l=i.length;s<l;s++){let c=i[s];if(c.type==="paragraph"){let m=await y({node:c,customNodes:t,list:{type:n,level:r,orderedListInstanceId:a}});Array.isArray(m)?o.push(...m):o.push(m)}else if(c.type==="bulletList")o.push(...await D({node:c,customNodes:t,level:r+1}));else if(c.type==="orderedList")o.push(...await L({node:c,level:r+1,customNodes:t}));else{let m=await y({node:c,customNodes:t});Array.isArray(m)?o.push(...m):o.push(m)}}return o}async function D({node:e,customNodes:n,level:r=0}){let a=e.content||[];return(await Promise.all(a.map(o=>F({item:o,listType:"bullet",level:r,customNodes:n})))).flat().filter(o=>o!==null)}import{Math as Oe,MathRun as et,Paragraph as Ee}from"docx";function J({node:e}){var r;if(!((r=e.attrs)!=null&&r.latex))return null;let n=e.attrs.latex;try{let a=b(n);return new Ee({children:[new Oe({children:a})]})}catch{return new Ee({children:[new Oe({children:[new et(n)]})]})}}async function Z({node:e,customNodes:n}){return e.content?(await Promise.all(e.content.map(a=>y({node:a,customNodes:n,options:{style:"Quote"}})))).flatMap(a=>Array.isArray(a)?a:[a]):[]}import{BorderStyle as A,convertInchesToTwip as W,Table as nt,TableLayoutType as ot,TableRow as at,WidthType as it}from"docx";import{Paragraph as tt,TableCell as rt,WidthType as Ie}from"docx";async function k({node:e,customNodes:n,columnWidthPercentage:r,columnWidthTwips:a,totalColumns:t}){var p;let o=(e.content||[]).map(async f=>f.type==="paragraph"?y({node:f,customNodes:n}):new tt({children:[]})),s=(await Promise.all(o)).flatMap(f=>(Array.isArray(f),f)),l=(p=e.attrs)!=null&&p.colspan?Number(e.attrs.colspan):1,c=a!==void 0,m;c?m=a*l:r?m=r*l:m=100/(t||1)*l;let u={children:s,width:{size:m,type:c?Ie.DXA:Ie.PERCENTAGE}};return e.attrs&&e.attrs.colspan&&Number(e.attrs.colspan)>1&&(u.columnSpan=Number(e.attrs.colspan)),new rt(u)}function st(e){let n=(e.content||[]).map(a=>(a.content||[]).reduce((t,o)=>{var s;let i=(s=o.attrs)!=null&&s.colspan?Number(o.attrs.colspan):1;return t+Math.max(1,i)},0));return Math.max(...n,0)||1}async function K({node:e,customNodes:n,pageSize:r,pageMargins:a}){let t=st(e),o=(r==null?void 0:r.width)||"21.0cm",i=(a==null?void 0:a.left)||"3.17cm",s=(a==null?void 0:a.right)||"3.17cm",l=d=>{var H;let h=((H=d.match(/[a-z%]+$/i))==null?void 0:H[0])||"cm",w=parseFloat(d.replace(/[a-z%]/gi,""));switch(h.toLowerCase()){case"cm":return Math.round(w*567);case"in":return Math.round(w*1440);case"pt":return Math.round(w*20);case"pc":return Math.round(w*240);case"mm":return Math.round(w*56.7);case"px":return Math.round(w*15);default:return Math.round(w*567)}},c=l(o),m=l(i),u=l(s),p=c-m-u,f=100/t,N=Math.floor(p/t),P=await Promise.all((e.content||[]).map(async d=>{let h=await Promise.all((d.content||[]).map(async w=>k({node:w,customNodes:n,columnWidthPercentage:f,columnWidthTwips:N,totalColumns:t})));return new at({children:h})}));return new nt({rows:P,width:{size:p,type:it.DXA},layout:ot.FIXED,columnWidths:Array(t).fill(N),margins:{top:W(.01),bottom:W(.01),left:W(.01),right:W(.01)},borders:{top:{style:A.SINGLE,size:4,color:"auto"},bottom:{style:A.SINGLE,size:4,color:"auto"},left:{style:A.SINGLE,size:4,color:"auto"},right:{style:A.SINGLE,size:4,color:"auto"},insideHorizontal:{style:A.SINGLE,size:4,color:"auto"},insideVertical:{style:A.SINGLE,size:4,color:"auto"}}})}async function Y({node:e,customNodes:n=[],pageSize:r,pageMargins:a}){switch(e.type){case"paragraph":return y({node:e,customNodes:n});case"bulletList":return D({node:e,customNodes:n});case"orderedList":return L({node:e,customNodes:n});case"listItem":return F({item:e,listType:"bullet",customNodes:n});case"table":return K({node:e,customNodes:n,pageSize:r,pageMargins:a});case"image":return[await R({node:e})];case"heading":return Q({node:e,customNodes:n});case"blockquote":return Z({node:e,customNodes:n});case"horizontalRule":return $();case"blockMath":return J({node:e});default:{if(n){let t=n.find(o=>o.type===e.type);return t?t.render(e):(console.error(`Custom node "${e.type}" not found`),[])}return[]}}}function j(e,n){return typeof e!="object"||e===null?n:(typeof n!="object"||n===null||Object.keys(n).forEach(r=>{let a=n[r],t=e[r];if(Array.isArray(a)&&Array.isArray(t)){let o=[...t];a.forEach(i=>{if(i&&typeof i=="object"&&i.id){let s=o.findIndex(l=>l.id===i.id);s!==-1?o[s]=j(o[s],i):o.push(i)}else o.push(i)}),e[r]=o}else typeof a=="object"?e[r]=j(typeof t=="object"&&t!==null?t:{},a):e[r]=a}),e)}async function He({node:e,customNodes:n=[],styleOverrides:r,pageSize:a,pageMargins:t,headers:o,footers:i}){let s=j(ie,r),l=(e.content||[]).map(f=>Y({node:f,customNodes:n,styleOverrides:s,pageSize:a,pageMargins:t})),m=(await Promise.all(l)).flatMap(f=>Array.isArray(f)?f:f instanceof ct||f instanceof mt?[f]:[]),u={default:(o==null?void 0:o.default)instanceof Function?await o.default():o==null?void 0:o.default,first:(o==null?void 0:o.first)instanceof Function?await o.first():o==null?void 0:o.first,even:(o==null?void 0:o.even)instanceof Function?await o.even():o==null?void 0:o.even},p={default:(i==null?void 0:i.default)instanceof Function?await i.default():i==null?void 0:i.default,first:(i==null?void 0:i.first)instanceof Function?await i.first():i==null?void 0:i.first,even:(i==null?void 0:i.even)instanceof Function?await i.even():i==null?void 0:i.even};return Pe(),new lt({numbering:{config:[{reference:"ordered-list",levels:[{level:0,format:I.DECIMAL,text:"%1.",alignment:"left",style:{paragraph:{indent:{left:720,hanging:360}}}},{level:1,format:I.DECIMAL,text:"%2.",alignment:"left",style:{paragraph:{indent:{left:1140,hanging:360}}}},{level:2,format:I.DECIMAL,text:"%3.",alignment:"left",style:{paragraph:{indent:{left:1440,hanging:360}}}},{level:3,format:I.DECIMAL,text:"%4.",alignment:"left",style:{paragraph:{indent:{left:1740,hanging:360}}}},{level:4,format:I.DECIMAL,text:"%5.",alignment:"left",style:{paragraph:{indent:{left:2040,hanging:360}}}},{level:5,format:I.DECIMAL,text:"%6.",alignment:"left",style:{paragraph:{indent:{left:2340,hanging:360}}}},{level:6,format:I.DECIMAL,text:"%7.",alignment:"left",style:{paragraph:{indent:{left:2640,hanging:360}}}},{level:7,format:I.DECIMAL,text:"%8.",alignment:"left",style:{paragraph:{indent:{left:2940,hanging:360}}}},{level:8,format:I.DECIMAL,text:"%9.",alignment:"left",style:{paragraph:{indent:{left:3240,hanging:360}}}}]}]},evenAndOddHeaderAndFooters:!!(o!=null&&o.evenAndOddHeaders)||!!(i!=null&&i.evenAndOddFooters),sections:[{properties:{page:{size:{width:(a==null?void 0:a.width)||"21.0cm",height:(a==null?void 0:a.height)||"29.7cm"},margin:{top:(t==null?void 0:t.top)||"2.54cm",bottom:(t==null?void 0:t.bottom)||"2.54cm",left:(t==null?void 0:t.left)||"3.17cm",right:(t==null?void 0:t.right)||"3.17cm"}},titlePage:!!(o!=null&&o.first)||!!(i!=null&&i.first)},headers:u,footers:p,children:m}],styles:s})}var ee=async({document:e,exportType:n,customNodes:r,styleOverrides:a,pageSize:t,pageMargins:o,headers:i=void 0,footers:s=void 0,extensions:l=[]})=>{for(let u of l)if(u.id==="export-docx-header-footer"){let p=u[Symbol.for("docx-header-footer")],f=!!i,N=!!s;!(p!=null&&p.allowedHeadersAndFooters)&&(f||N)&&(i=void 0,s=void 0,console.warn("The [exportDocx] function requires the [ExportDocxHeaderFooter] extension to be passed to the `extensions` array to use headers and footers"))}let c=await He({node:e,styleOverrides:a,customNodes:r,headers:i,footers:s,pageSize:t,pageMargins:o});if(!c)throw new Error("Failed to convert document");let m;try{switch(n){case"buffer":m=await S.toBuffer(c);break;case"string":m=await S.toString(c);break;case"base64":m=await S.toBase64String(c);break;case"blob":m=await S.toBlob(c);break;case"stream":m=S.toStream(c);break;default:throw new Error("Invalid export type")}}catch(u){throw new Error(`Failed to export document: ${u.message}`)}return m};import{Extension as pt}from"@tiptap/core";var te="export-docx-header-footer",ut=pt.create({name:"export-docx",addOptions(){return{styleOverrides:{},customNodes:[],exportType:"blob",headers:void 0,footers:void 0,pageSize:void 0,pageMargins:void 0,extensions:[],onCompleteExport:()=>{throw new Error("The [exportDocx] extension requires an [onCompleteExport] callback function to handle the exported DOCX file")}}},addCommands(){return{exportDocx:e=>async({editor:n})=>{var N,P,d,h,w,H,C,re,ne,oe,ae;let r=n.getJSON(),a=Symbol.for("docx-header-footer"),t="none",o=(P=(N=e==null?void 0:e.extensions)!=null?N:this.options.extensions)!=null?P:[],i=n.extensionManager.extensions.find(O=>O.name==="export-docx-header-footer"),s=o.find(O=>O.id===te);i?t="editor":s&&(t="options");let l=!!(e!=null&&e.headers||this.options.headers),c=!!(e!=null&&e.footers||this.options.footers),m,u;if(t==="editor"){let O=i==null?void 0:i.options[a];u={id:te,[a]:O},m=O==null?void 0:O.allowedHeadersAndFooters}else t==="options"?(u=s,m=(d=u==null?void 0:u[a])==null?void 0:d.allowedHeadersAndFooters):m=!1;let p={document:r,styleOverrides:(h=e==null?void 0:e.styleOverrides)!=null?h:this.options.styleOverrides,customNodes:(w=e==null?void 0:e.customNodes)!=null?w:this.options.customNodes,exportType:(H=e==null?void 0:e.exportType)!=null?H:this.options.exportType,pageSize:(C=e==null?void 0:e.pageSize)!=null?C:this.options.pageSize,pageMargins:(re=e==null?void 0:e.pageMargins)!=null?re:this.options.pageMargins,extensions:[]};!m&&(l||c)&&console.warn("The [ExportDocx] extension requires the [ExportDocxHeaderFooter] extension to be provided in `extensions` with allowedHeadersAndFooters=true to use headers and footers"),m?(p.headers=(ne=e==null?void 0:e.headers)!=null?ne:this.options.headers,p.footers=(oe=e==null?void 0:e.footers)!=null?oe:this.options.footers,p.extensions=u?[u]:[]):(p.headers=void 0,p.footers=void 0,p.extensions=(ae=p.extensions)==null?void 0:ae.filter(O=>O.id!==te));let f=await ee(p);return e!=null&&e.onCompleteExport?e.onCompleteExport(f):this.options.onCompleteExport(f),!0}}}});import{Header as Fe}from"docx";async function ft({node:e}){let n=await y({node:e,customNodes:[]});return Array.isArray(n)?new Fe({children:n}):new Fe({children:[n]})}import{Header as Me}from"docx";async function dt({node:e}){let n=await y({node:e,customNodes:[]});return Array.isArray(n)?new Me({children:n}):new Me({children:[n]})}import{TableRow as ht}from"docx";async function gt({node:e,customNodes:n}){let a=(await Promise.all((e.content||[]).map(t=>k({node:t,customNodes:n,columnWidthPercentage:void 0,columnWidthTwips:void 0,totalColumns:void 0})))).filter(t=>t!==null);return new ht({children:a})}function xt(e){return e*.75}import*as bt from"docx";export{bt as Docx,ut as ExportDocx,J as convertBlockMath,D as convertBulletList,ft as convertFooter,dt as convertHeader,Q as convertHeading,$ as convertHorizontalRule,R as convertImage,q as convertInlineMath,F as convertListItem,Y as convertNode,L as convertOrderedList,y as convertParagraph,Z as convertQuote,K as convertTable,k as convertTableCell,gt as convertTableRow,U as convertTextNode,ee as exportDocx,x as lineHeightToDocx,X as pixelsToHalfPoints,xt as pixelsToPoints,T as pointsToHalfPoints,g as pointsToTwips};

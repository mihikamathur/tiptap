"use strict";var d=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var O=Object.getOwnPropertyNames;var C=Object.prototype.hasOwnProperty;var N=(t,o)=>{for(var r in o)d(t,r,{get:o[r],enumerable:!0})},w=(t,o,r,p)=>{if(o&&typeof o=="object"||typeof o=="function")for(let e of O(o))!C.call(t,e)&&e!==r&&d(t,e,{get:()=>o[e],enumerable:!(p=k(o,e))||p.enumerable});return t};var S=t=>w(d({},"__esModule",{value:!0}),t);var U={};N(U,{ImportDocx:()=>m,default:()=>x});module.exports=S(U);var g=require("@tiptap/core");function u({json:t,validMarks:o,validNodes:r,options:p,rewrittenContent:e=[]}){return t.marks&&Array.isArray(t.marks)&&(t.marks=t.marks.filter(n=>{let s=typeof n=="string"?n:n.type;return o.has(s)?!0:(e.push({original:JSON.parse(JSON.stringify(t)),unsupported:s}),!1)})),t.content&&Array.isArray(t.content)&&(t.content=t.content.map(n=>u({json:n,validMarks:o,validNodes:r,options:p,rewrittenContent:e}).json).filter(n=>n!=null)),t.type&&!r.has(t.type)?t.content&&Array.isArray(t.content)?(e.push({original:JSON.parse(JSON.stringify(t)),unsupported:t.type}),t.type="paragraph",{json:t,rewrittenContent:e}):{json:null,rewrittenContent:e}:{json:t,rewrittenContent:e}}function f(t,o,r){return u({json:t,validNodes:new Set(Object.keys(o.nodes)),validMarks:new Set(Object.keys(o.marks)),options:r})}var h="https://api.tiptap.dev/v2/convert",m=g.Extension.create({name:"import-docx",addOptions(){return{endpoint:h,token:"",appId:"",imageUploadCallbackUrl:void 0,verbose:0}},addCommands(){return{importDocx:t=>()=>{let{file:o}=t,{onImport:r}=t,e=`${this.options.endpoint||h}/import`,n=new FormData;n.append("file",o),this.options.imageUploadCallbackUrl&&n.append("imageUploadCallbackUrl",this.options.imageUploadCallbackUrl),this.options.prosemirrorNodes&&n.append("prosemirrorNodes",JSON.stringify(this.options.prosemirrorNodes)),this.options.prosemirrorMarks&&n.append("prosemirrorMarks",JSON.stringify(this.options.prosemirrorMarks)),this.options.verbose&&n.append("verbose",this.options.verbose.toString());let s=new URL(e);return fetch(s.href,{method:"POST",body:n,headers:{Authorization:`Bearer ${this.options.token}`,"X-App-Id":this.options.appId,"X-Tiptap-Extension":"import-docx"}}).then(i=>{if(!i.ok)throw new Error(i.statusText);return i.json()}).then(i=>{let l=(y=i.data.content)=>{try{let{json:a,rewrittenContent:c}=f(y,this.editor.schema);c.length&&process.env.NODE_ENV==="development"&&console.warn("Unknown content was found and replaced:",c),this.editor.commands.setContent(a)}catch(a){throw console.error(a),a}};return r?r({content:i.data.content,logs:i.logs,error:null,setEditorContent:l}):l()}).catch(i=>{if(r)r({content:null,error:i});else throw i}),!0}}}});var x=m;0&&(module.exports={ImportDocx});

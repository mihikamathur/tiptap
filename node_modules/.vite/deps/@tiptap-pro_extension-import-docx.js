import {
  Extension
} from "./chunk-BI5E4KEG.js";
import "./chunk-G3PMV62Z.js";

// node_modules/@tiptap-pro/extension-import-docx/dist/index.js
function l({ json: t, validMarks: i, validNodes: r, options: a, rewrittenContent: e = [] }) {
  return t.marks && Array.isArray(t.marks) && (t.marks = t.marks.filter((o) => {
    let p = typeof o == "string" ? o : o.type;
    return i.has(p) ? true : (e.push({ original: JSON.parse(JSON.stringify(t)), unsupported: p }), false);
  })), t.content && Array.isArray(t.content) && (t.content = t.content.map((o) => l({ json: o, validMarks: i, validNodes: r, options: a, rewrittenContent: e }).json).filter((o) => o != null)), t.type && !r.has(t.type) ? t.content && Array.isArray(t.content) ? (e.push({ original: JSON.parse(JSON.stringify(t)), unsupported: t.type }), t.type = "paragraph", { json: t, rewrittenContent: e }) : { json: null, rewrittenContent: e } : { json: t, rewrittenContent: e };
}
function c(t, i, r) {
  return l({ json: t, validNodes: new Set(Object.keys(i.nodes)), validMarks: new Set(Object.keys(i.marks)), options: r });
}
var u = "https://api.tiptap.dev/v2/convert";
var f = Extension.create({ name: "import-docx", addOptions() {
  return { endpoint: u, token: "", appId: "", imageUploadCallbackUrl: void 0, verbose: 0 };
}, addCommands() {
  return { importDocx: (t) => () => {
    let { file: i } = t, { onImport: r } = t, e = `${this.options.endpoint || u}/import`, o = new FormData();
    o.append("file", i), this.options.imageUploadCallbackUrl && o.append("imageUploadCallbackUrl", this.options.imageUploadCallbackUrl), this.options.prosemirrorNodes && o.append("prosemirrorNodes", JSON.stringify(this.options.prosemirrorNodes)), this.options.prosemirrorMarks && o.append("prosemirrorMarks", JSON.stringify(this.options.prosemirrorMarks)), this.options.verbose && o.append("verbose", this.options.verbose.toString());
    let p = new URL(e);
    return fetch(p.href, { method: "POST", body: o, headers: { Authorization: `Bearer ${this.options.token}`, "X-App-Id": this.options.appId, "X-Tiptap-Extension": "import-docx" } }).then((n) => {
      if (!n.ok) throw new Error(n.statusText);
      return n.json();
    }).then((n) => {
      let d = (h = n.data.content) => {
        try {
          let { json: s, rewrittenContent: m } = c(h, this.editor.schema);
          m.length && true && console.warn("Unknown content was found and replaced:", m), this.editor.commands.setContent(s);
        } catch (s) {
          throw console.error(s), s;
        }
      };
      return r ? r({ content: n.data.content, logs: n.logs, error: null, setEditorContent: d }) : d();
    }).catch((n) => {
      if (r) r({ content: null, error: n });
      else throw n;
    }), true;
  } };
} });
var w = f;
export {
  f as ImportDocx,
  w as default
};
//# sourceMappingURL=@tiptap-pro_extension-import-docx.js.map
